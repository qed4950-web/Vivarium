# 🌱 스마트 가드닝 AIoT

## **전체 운영 로직 가이드라인 (Automation Flow Guideline)**

비전 AI + IoT 센서 + 제어 시스템을 통합한 최종 자동화 설계 문서

---

# 🎯 1. 목적

이 문서는 **스마트 가드닝 AIoT 서비스 전체가 실제로 어떻게 동작하는지**
운영 로직(Automation Flow)을 구조화하여 제공한다.

* 비전 AI 모델 흐름
* 센서 데이터 흐름
* IoT 제어 프로세스
* 사용자 앱(Electron) 상호작용
* 아파트·주거단지에 적용 가능한 운영 방안
* 예외 처리/안전 로직

---

# 🌐 2. 전체 시스템 아키텍처

```
                   ┌──────────────────────┐
                   │   Vision AI Server   │
                   │ (Python + YOLO/ONNX) │
                   └──────────┬───────────┘
                              │
                     detection results
                              │
                 ┌───────────▼───────────┐
                 │   Automation Engine    │
                 │  (Decision Logic Layer)│
                 └───────┬───────┬───────┘
                         │       │
                         │       │
            sensor data  │       │ control commands
                         │       │
                 ┌───────▼───────▼───────┐
                 │     ESP32 / Arduino    │
                 │  (Pump/LED/Fan/Mist)   │
                 └───────┬───────┬───────┘
                         │       │
                         │       │
           sensor values │       │ actions
                         │       │
                   ┌─────▼───────▼─────┐
                   │  Electron / App UI │
                   └─────────────────────┘
```

---

# 🧠 3. 운영 핵심 개념 5가지

### ✔ (1) **AI 판단(Python)과 물리 제어(ESP32)는 분리한다**

→ 안정성, 유지보수, 확장성 ↑

### ✔ (2) **MCU는 센서/펌프/LED만 담당**

→ 로직이 단순해지고 고장 확률 ↓

### ✔ (3) **Python이 “두뇌” 역할 수행**

* 병반/스트레스 감지
* 성장 속도 분석
* 급수 주기 결정

### ✔ (4) **모든 데이터는 Electron UI에 시각화**

→ 입주자/관리자에게 보고 가능

### ✔ (5) **AI 모델은 지속 업데이트 (Roboflow Versioning)**

→ 자동 학습 개선 구조 가능

---

# 📸 4. 비전 AI 동작 로직

비전 모델이 수행하는 핵심 역할:

1. 병해 탐지

   * leaf_spot
   * brown_spot
   * leaf_mold
   * leaf_damage

2. 스트레스 수준 평가

   * healthy_leaf
   * stressed_leaf
   * dry_leaf
   * yellowing_leaf
   * wilted_leaf

3. 성장 추적

   * 잎 크기 증가
   * 잎 수 증가
   * 색 변화
   * 일별 성장 차트

### 실행 주기:

* 12시간 간격(추천)
* 관리자 모드: 1시간 간격
* 이벤트 발생 시(병반 감지): 즉시 분석

---

# 🌡️ 5. 센서 데이터 처리 로직

ESP32에서 읽는 값:

| 센서             | 의미     | 동작      |
| -------------- | ------ | ------- |
| SHT31          | 온도/습도  | 생육환경 감시 |
| BH1750         | 조도(광량) | LED 조절  |
| Soil Moisture  | 토양 습도  | 펌프 자동   |
| CO2 Sensor(선택) | 공기 질   | 환기      |

### 주기

* 10초/1분 간격 보고 (configurable)

---

# 🔀 6. Automation Engine 로직(의사결정 엔진)

Python 서버 내부에 위치.

## ✔ A. 급수(Watering)

```
if "dry_leaf" detected:
    pump_time = 2 sec
elif soil_moisture < 30%:
    pump_time = 3 sec
elif "wilted_leaf" strongly detected:
    pump_time = 4 sec
```

## ✔ B. 조명(Light)

```
if "yellowing_leaf" detected:
    extend LED by +1 hour
elif BH1750 < threshold:
    LED ON
else:
    LED OFF
```

## ✔ C. 환기(Fan/Humidity)

```
if "leaf_mold" detected:
    FAN ON for 5 minutes
elif humidity > 80%:
    FAN ON
else:
    FAN OFF
```

## ✔ D. 병충해(Pests)

```
if aphid or spider_mite detected:
    notify user immediately
    recommend pesticide action
    log event to history
```

---

# 🔌 7. ESP32 제어 동작

Automation Engine이 전달하는 명령:

```
PUMP_ON / PUMP_OFF  
LED_ON / LED_OFF  
FAN_ON / FAN_OFF  
MIST_ON / MIST_OFF
```

실제 제어는 MCU가 수행하기 때문에 안전함.

---

# 📊 8. UI(Electron) 상호작용

UI에 표시되는 정보:

* 식물 상태 대시보드
* 현재 감지된 병해/스트레스
* 자동화 기록 (급수/조명/환기)
* 일별 성장 차트
* 카메라 이미지 히스토리
* 수동 제어 (관리자 모드)

---

# ⚠️ 9. 예외 처리 / 안전 로직

아파트/주거단지용 서비스 필수 사항.

### ✔ 1) 물 넘침 방지

펌프 연속 동작 최대 10초 제한

### ✔ 2) 야간 모드

22:00~06:00 LED 자동 OFF
(식물 생리·입주자 편의 고려)

### ✔ 3) 통신 실패 시

* AI 서버 다운 → MCU는 기본 생육모드 유지
* WiFi 끊김 → 오프라인 동작 fallback
* 센서 오류 → UI에 경고 표시

### ✔ 4) 장시간 무반응

24시간 데이터 없음 → 자동 점검 모드

---

# 🛠 10. 운영/배포 전략

### ✔ 1) 아파트 단위 시스템

* 장비 설치 → 중앙 서버와 연결
* 관리자 모드에서 모든 세대/구역 관리
* 커뮤니티 가드닝 공간은 카메라 + 센서 확장

### ✔ 2) 세대 단위

* 각 가정에 스마트 화분 1~2개
* 앱을 통한 자동 관리
* 문제가 생기면 UI로 즉시 안내

### ✔ 3) 모델 업데이트

* Roboflow Version 업데이트
* 기존 데이터 자동 Merge
* 모델 성능 향상 후 재배포

---

# 🏁 11. 정리: 완전한 자동화 사이클

```
1. 센서 → 상태 수집
2. 카메라 → 이미지 캡처
3. Python → AI 분석
4. Automation Engine → 의사결정
5. ESP32 → 장치 제어
6. Electron UI → 사용자 보고
7. 데이터 저장 → 지속적 학습 개선
```

이로써 **완전한 Smart Gardening AIoT 자동제어 시스템**이 완성된다.

